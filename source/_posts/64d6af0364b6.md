---
title: 在服务器上搭建内网代理
date: 2024-08-09 15:22:01
---

**声明：本人热爱中华人民共和国、中国共产党和社会主义，主动参与共建和谐社会，绝对无意利用技术违背法律和破坏稳定。本文内提及的一切均为了科学研究和个人参考，也请各位理性参与，在网络上做守法公民。**

之前在 [code-server 那一篇](./7c0f3adef71e.md)里我提到要教大家搭建代理服务器，如今又到了填坑的时候，本文涉及到一些敏感技术，请大家理性阅读。

本文中我们将使用 v2raya 和 v2ray 内核，在香橙派的 Armbian 上安装（这个环境的搭建在上述文章中详细解释过），如果想使用 Xray 之类的其他内核请自行替换。v2raya 是罕见的仍在积极开发的 Linux v2ray 客户端，因此我们选用它。

首先我们通过 GitHub 镜像下载需要的文件：

```bash
su
wget https://github.moeyy.xyz/https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh
wget https://github.moeyy.xyz/https://github.com/v2rayA/v2rayA/releases/download/v2.2.5.8/installer_debian_arm64_2.2.5.8.deb
```

然后，打开 nano 并用 Ctrl-W 查找一下 `DOWNLOAD_LINK` 配置，并在后面的链接前加上我们的加速网址 `https://github.moeyy.xyz`。

随后：

```bash
bash install-release.sh
```

静候完成。

然后：

```bash
apt install ./installer_debian_arm64_2.2.5.8.deb
```

同样稍候安装。

完成后，启用 v2raya 单元：

```bash
systemctl enable --now v2raya.service
```

如果你使用防火墙，需要添加端口：

```bash
firewall-cmd --permanent --zone=public --add-port=2017/tcp
firewall-cmd --permanent --zone=public --add-port=20171/tcp
```

然后就可以访问 `[OPI_IP]:2017`，设置管理员账户。

在管理页面上，我们点击 Import 将你的节点导入，然后在 Setting 中启用 IP Forwarding 和 Port Sharing，这样我们可以在内网访问，然后在旁边的 Transparent Proxy/System Proxy 中选择 On: Do not Split Traffic，然后选择 Save and Apply。

选择一个节点，并且点击左上角红色的 Start 按钮，v2raya 就启动了，可以在系统代理或者浏览器代理中填入 IP 和 HTTP 代理端口 20171，就能使用代理上网了！

同时，v2raya 会自动拦截本地所有流量，所以你的终端下下载会飞快，在上述的教程中我建议添加 BFSU 的镜像，就是因为它在大部分代理节点下速度都还行，适合我们的情景。
